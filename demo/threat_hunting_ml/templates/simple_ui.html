<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Threat Hunting ML - Simple Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .dashboard-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: none;
            transition: transform 0.3s ease;
        }
        .dashboard-card:hover {
            transform: translateY(-5px);
        }
        .btn-custom {
            border-radius: 25px;
            padding: 12px 30px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            border: none;
        }
        .btn-generate { background: linear-gradient(45deg, #FF6B6B, #EE5A24); color: white; }
        .btn-train { background: linear-gradient(45deg, #4ECDC4, #44A08D); color: white; }
        .btn-detect { background: linear-gradient(45deg, #45B7D1, #96CEB4); color: white; }
        .btn-visualize { background: linear-gradient(45deg, #FECA57, #FF9FF3); color: black; }
        .btn-download { background: linear-gradient(45deg, #48DBFB, #0ABDE3); color: white; }
        .btn-custom:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-success { background-color: #2ecc71; }
        .status-warning { background-color: #f39c12; }
        .status-error { background-color: #e74c3c; }
        .progress-bar {
            border-radius: 10px;
        }
        .result-card {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px;
        }
        .metric-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .metric-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        .alert-custom {
            border-radius: 10px;
            border: none;
        }
        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }
        .step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin: 0 10px;
            position: relative;
        }
        .step.active {
            background: white;
            color: #667eea;
        }
        .step-line {
            height: 2px;
            background: rgba(255,255,255,0.3);
            flex: 1;
            margin-top: -20px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-transparent mb-4">
        <div class="container">
            <span class="navbar-brand mb-0 h1">
                <i class="fas fa-shield-alt me-2"></i>
                Threat Hunting ML Dashboard
            </span>
        </div>
    </nav>

    <div class="container">
        <!-- Progress Steps -->
        <div class="step-indicator mb-4">
            <div class="step active" id="step1">1</div>
            <div class="step-line"></div>
            <div class="step" id="step2">2</div>
            <div class="step-line"></div>
            <div class="step" id="step3">3</div>
            <div class="step-line"></div>
            <div class="step" id="step4">4</div>
        </div>

        <div class="row">
            <div class="col-lg-8 mx-auto">
                <!-- Main Action Card -->
                <div class="card dashboard-card mb-4">
                    <div class="card-body p-4">
                        <h3 class="card-title text-center mb-4">
                            <i class="fas fa-cogs me-2"></i>
                            Security Analysis Pipeline
                        </h3>

                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <label for="numLogs" class="form-label fw-bold">
                                    <i class="fas fa-database me-1"></i>
                                    Number of Security Logs
                                </label>
                                <input type="number" id="numLogs" class="form-control form-control-lg"
                                       placeholder="Enter number of logs" value="10000" min="100" max="50000">
                            </div>
                            <div class="col-md-6 d-flex align-items-end">
                                <button id="generateData" class="btn btn-custom btn-generate w-100 btn-lg">
                                    <i class="fas fa-plus-circle me-2"></i>
                                    Generate Data
                                </button>
                            </div>
                        </div>

                        <div class="row g-3">
                            <div class="col-md-4">
                                <button id="trainModels" class="btn btn-custom btn-train w-100">
                                    <i class="fas fa-brain me-2"></i>
                                    Train AI Models
                                </button>
                            </div>
                            <div class="col-md-4">
                                <button id="detectThreats" class="btn btn-custom btn-detect w-100">
                                    <i class="fas fa-search me-2"></i>
                                    Detect Threats
                                </button>
                            </div>
                            <div class="col-md-4">
                                <button id="visualize" class="btn btn-custom btn-visualize w-100">
                                    <i class="fas fa-chart-bar me-2"></i>
                                    View Charts
                                </button>
                            </div>
                        </div>

                        <div class="text-center mt-3">
                            <button id="downloadResults" class="btn btn-custom btn-download">
                                <i class="fas fa-download me-2"></i>
                                Export Results
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Status Messages -->
                <div id="statusMessage" class="alert alert-custom alert-info d-none">
                    <div class="d-flex align-items-center">
                        <div class="status-indicator status-success" id="statusIndicator"></div>
                        <span id="statusText">Ready to start analysis...</span>
                    </div>
                </div>

                <!-- Progress Bar -->
                <div id="progressContainer" class="d-none mb-4">
                    <div class="card dashboard-card">
                        <div class="card-body">
                            <h6 class="card-title">
                                <i class="fas fa-spinner fa-spin me-2"></i>
                                Processing...
                            </h6>
                            <div class="progress">
                                <div class="progress-bar progress-bar-striped progress-bar-animated"
                                     role="progressbar" style="width: 0%" id="progressBar"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Results Cards -->
                <div id="resultsContainer" class="d-none">
                    <div class="row g-3 mb-4">
                        <div class="col-md-4">
                            <div class="card result-card text-center">
                                <div class="card-body">
                                    <div class="metric-number" id="totalLogs">-</div>
                                    <div class="metric-label">Total Logs</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card result-card text-center">
                                <div class="card-body">
                                    <div class="metric-number" id="threatsDetected">-</div>
                                    <div class="metric-label">Threats Found</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card result-card text-center">
                                <div class="card-body">
                                    <div class="metric-number" id="threatPercentage">-%</div>
                                    <div class="metric-label">Threat Rate</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Analysis Details -->
                    <div class="card dashboard-card">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">
                                <i class="fas fa-chart-pie me-2"></i>
                                Threat Analysis Summary
                            </h5>
                        </div>
                        <div class="card-body">
                            <div id="analysisText" class="text-muted">
                                Click "Detect Threats" to see detailed analysis...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Visualization Container -->
                <div id="visualizationContainer" class="d-none mt-4">
                    <div class="card dashboard-card">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0">
                                <i class="fas fa-chart-line me-2"></i>
                                Threat Pattern Visualization
                            </h5>
                        </div>
                        <div class="card-body text-center">
                            <img id="vizImage" src="" alt="Threat Analysis Charts"
                                 class="img-fluid rounded shadow" style="max-height: 500px;">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentStep = 1;

        function updateSteps(step) {
            currentStep = step;
            for (let i = 1; i <= 4; i++) {
                const stepElement = $(`#step${i}`);
                if (i <= step) {
                    stepElement.addClass('active');
                } else {
                    stepElement.removeClass('active');
                }
            }
        }

        function showStatus(message, type = 'info') {
            const statusColors = {
                'success': 'status-success',
                'warning': 'status-warning',
                'error': 'status-error',
                'info': 'status-success'
            };

            $('#statusIndicator').removeClass('status-success status-warning status-error')
                                .addClass(statusColors[type]);
            $('#statusText').text(message);
            $('#statusMessage').removeClass('alert-info alert-success alert-warning alert-danger')
                             .addClass(`alert-${type}`).removeClass('d-none');
        }

        function showProgress(show = true) {
            if (show) {
                $('#progressContainer').removeClass('d-none');
                $('#progressBar').css('width', '0%');
            } else {
                $('#progressContainer').addClass('d-none');
            }
        }

        function updateProgress(percent) {
            $('#progressBar').css('width', `${percent}%`);
        }

        $(document).ready(function() {
            showStatus('Ready to start threat hunting analysis!', 'info');

            $('#generateData').click(function() {
                const numLogs = $('#numLogs').val();
                if (!numLogs || numLogs < 100) {
                    showStatus('Please enter at least 100 logs', 'warning');
                    return;
                }

                showStatus('Generating security log data...', 'info');
                showProgress(true);
                updateProgress(30);

                $.post('/generate_data', { num_logs: numLogs }, function(data) {
                    showProgress(false);
                    if (data.status === 'success') {
                        showStatus(`✅ Generated ${numLogs} security logs successfully!`, 'success');
                        updateSteps(1);
                        $('#resultsContainer').addClass('d-none');
                        $('#visualizationContainer').addClass('d-none');
                    } else {
                        showStatus('❌ Error generating data: ' + data.message, 'error');
                    }
                }).fail(function() {
                    showProgress(false);
                    showStatus('❌ Failed to generate data', 'error');
                });
            });

            $('#trainModels').click(function() {
                showStatus('Training AI models... This may take 30-60 seconds', 'info');
                showProgress(true);
                updateProgress(20);

                const progressInterval = setInterval(() => {
                    updateProgress(Math.min(80, $('#progressBar').width() / $('#progressBar').parent().width() * 100 + 10));
                }, 2000);

                $.post('/train_models', {}, function(data) {
                    clearInterval(progressInterval);
                    showProgress(false);
                    if (data.status === 'success') {
                        showStatus('✅ AI models trained successfully!', 'success');
                        updateSteps(2);
                    } else {
                        showStatus('❌ Error training models: ' + data.message, 'error');
                    }
                }).fail(function() {
                    clearInterval(progressInterval);
                    showProgress(false);
                    showStatus('❌ Failed to train models', 'error');
                });
            });

            $('#detectThreats').click(function() {
                showStatus('Analyzing logs for security threats...', 'info');
                showProgress(true);
                updateProgress(50);

                $.post('/detect_threats', {}, function(data) {
                    showProgress(false);
                    if (data.status === 'success') {
                        showStatus('✅ Threat analysis completed!', 'success');
                        updateSteps(3);

                        // Update metrics
                        $('#totalLogs').text(data.summary.total_logs.toLocaleString());
                        $('#threatsDetected').text(data.summary.threats_detected.toLocaleString());
                        $('#threatPercentage').text(data.summary.threat_percentage + '%');

                        // Show analysis
                        $('#analysisText').html('<pre style="white-space: pre-wrap; font-family: inherit;">' + data.analysis + '</pre>');
                        $('#resultsContainer').removeClass('d-none');
                    } else {
                        showStatus('❌ Error detecting threats: ' + data.message, 'error');
                    }
                }).fail(function() {
                    showProgress(false);
                    showStatus('❌ Failed to detect threats', 'error');
                });
            });

            $('#visualize').click(function() {
                showStatus('Generating visualization charts...', 'info');
                $('#vizImage').attr('src', '/visualize?' + new Date().getTime());
                $('#visualizationContainer').removeClass('d-none');
                updateSteps(4);
                showStatus('✅ Charts generated successfully!', 'success');
            });

            $('#downloadResults').click(function() {
                showStatus('Downloading results...', 'info');
                window.location.href = '/download_results';
                setTimeout(() => {
                    showStatus('✅ Results downloaded!', 'success');
                }, 1000);
            });
        });
    </script>
</body>
</html>
